

今天在回家的路上一直在思考ID生成器的一个问题：

我们的ID生成器生成的ID是一个uint64位的整数，它的最大值是：**1844 6744 0737 0955 1656**,它一共有20位，根据Chaos生成ID算法，我们将它分成5个部分：

**时间戳-随机数位-类型位-机器位-数据库标识**

其中位数组成分别为：10位+4位+2位+1位+2位，共19位，少了一位（关于Chaos算法，请移步大嘴老师的文章[Chaos-ID生成器的前世今生](http://www.94geek.com/blog/2017/idcreator-chaos/)，我们的问题是少这一位是不是值得?少一位可以在数据存储，数据传输上节省多少资源？多一位可以是ID多使用多少年？是否值得？我们这代人应该是看不到了:)

#### 磁盘损耗####

从 ID生成的角度来讲，可以有不同的业务类型，如日志ID，数据库ID，消息ID等，综合所有的业务量，我们假设每天可以产生100W条新生成的ID，那意味着，一个 ID多一bit，一天相当于多100W个bit，一年又365天，那么一年多了36500W个bit。一般服务器都会做异地容灾备份，就按最普通的3地备份，那么一年总的bit消耗将是109500W个bit。这仅仅是服务器上的数量。又假设，客户短每天的针对所有业务ID的访问量为100W，那么在所有客户机器上也会多出100W个bit，一年也将消耗36500W个bit。其它因素如缓存等暂且忽略，那么根据以上简单粗糙的计算可以得出，ID设计多一个bit，一年将多消耗146000W个bit，即174M的磁盘。

按当前磁盘市场价，300RMB/T，总共消耗0.00016元人民币/年。便宜！

#### 通信损耗

仍然按每天100W的访问量，相当于一年43M的网络传输。按照电信30M宽带，一年1200元，平均下载大约为2M/s。一年大约消耗0.0008元/年。便宜！

#### 内存消耗

仍然按照每天100W的访问量，一年占用43M内存，按照当前内存市场价（今年内存是大年）100元/G，相当于一年消耗4元/年。相比较而言贵一些，不过仍然是可以接受的。



综上粗糙的计算，如果设计ID多一位，将多消耗4.00096元，其中磁盘和网络可以忽略不计，内存占了大头。另外多设计上一位ID，将可以是ID生成器多寿命多用100年左右，虽然我们不一定用得上😄，不过4块买100年，现在看来还是蛮合算的。以上所有的计算数据未经任何实践认证，是作者拍脑所得，仅仅为论述本文观点所用，如有雷同，纯属巧合😄！



